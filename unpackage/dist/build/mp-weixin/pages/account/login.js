(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/account/login"],{"0945":function(e,t,n){"use strict";(function(e){n("ee7b"),n("921b");i(n("66fd"));var t=i(n("c40c"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"3cf8":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},"59ca":function(e,t,n){},"8cd7":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("2e85")),o=a(n("8efc")),s=n("2f62");function a(e){return e&&e.__esModule?e:{default:e}}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={computed:r({},(0,s.mapState)(["userInfo","hasLogin","system_config"])),data:function(){return{logoImage:"http://wenda.wecenter.com/static/mobile/img/login-logo.png",phoneData:"",passData:"",email:"",icode:"",use_icode:!1,isRotate:!1,showBind:!1,is_register:!1,register_type:""}},onLoad:function(e){this.wxLogin();var t=this.system_config;this.register_type=t.register_type,t&&"invite"==t.register_type&&(this.use_icode=!0)},methods:r({},(0,s.mapMutations)(["login"]),{toBack:function(){e.navigateBack()},wxLogin:function(t){var n=this;e.login({provider:"weixin",success:function(e){if(console.log("uni.loginRes",e),e.code){var t=e.code;n.login_code=t}else console.log("获取用户登录态失败！"+e.errMsg)}})},GetUserInfo:function(t){var n=this;console.log("GetUserInfo：",t);var s=t.detail.errMsg;if("getUserInfo:ok"==s){if(t.detail.userInfo){var a=encodeURIComponent(t.detail.encryptedData),r=t.detail.iv,c=t.detail.rawData,u=t.detail.signature,l=this.login_code,f={};f.code=l,f.encryptedData=a,f.iv=r,f.rawData=c,f.signature=u,this.$api.getUserInfo(f).then(function(t){var s=t.data.errno;if(1==s){var a=t.data.rsm.userInfo;n.login(a);var r=t.data.rsm.signature_token;r&&o.default.put("signature_token",r);var c=a.uid;c>0?setTimeout(function(){e.navigateBack()},800):"close"==n.register_type?(n.showBind=!0,n.is_register=!1,NavigationBarTitle="登录账号"):e.showModal({title:"小程序登录成功",content:"你需要绑定一个网站账号才可以继续操作",cancelText:"注册新号",confirmText:"绑定旧号",success:function(t){n.showBind=!0;var o="";if(t.confirm)n.is_register=!1,o="登录账号";else{if("close"==n.register_type)return i.default.errorToast("暂不支持新用户注册"),!1;n.is_register=!0,o="注册账号"}e.setNavigationBarTitle({title:o})},fail:function(e){n.showBind=!1,n.is_register=!1}})}else n.wxLogin(),console.log("解密失败",t)}).catch(function(e){console.log("返回错误",e),n.wxLogin()})}}else e.showModal({title:"授权失败",content:"请允许授权！授权仅仅是使用你的头像和昵称作为登录显示，不会泄露你的隐私",showCancel:!1,cancelText:"",confirmText:"好的",success:function(e){},fail:function(){},complete:function(){}})},ChangOperate:function(){if(this.is_register)this.is_register=!1,e.setNavigationBarTitle({title:"登录账号"});else{if("close"==this.register_type)return i.default.errorToast("已关闭新用户注册功能"),!1;this.is_register=!0,e.setNavigationBarTitle({title:"注册账号"})}},reg_account:function(t,n,s){var a=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if("close"==this.register_type)return i.default.errorToast("新用户注册功能已关闭"),!1;if(t&&n&&s){var c=this.userInfo;if(console.log("userInfo",c),""!=c.nickName&&this.hasLogin){var u={};u.user_name=t,u.password=n,u.email=s,"invite"==this.system_config.register_type&&this.icode&&(u.icode=r),u.userInfo=JSON.stringify(c),u.access_token=c.access_token,this.$api.reg_account(u).then(function(t){console.log("注册成功 reg_account",t);var n=t.data.rsm.user_info;if(n&&n.uid>0){c.user_info=n,c.uid=n.uid,c.access_token=t.data.rsm.access_token;var s=t.data.rsm.signature_token;s&&o.default.put("signature_token",s),console.log("reg_account userInfo",c),a.login(c),e.navigateBack({delta:1})}else i.default.errorToast("注册失败")}).catch(function(e){a.isRotate=!1,console.log("请求失败，可以在这里写处理代码",e)})}else i.default.showToast("请重新登录"),this.wxLogin(),this.showBind=!1}else i.default.errorToast("邮箱账号和密码不能为空")},bind_account:function(t,n){var s=this;if(t&&n){var a=this.userInfo;if(console.log("userInfo",a),""!=a.nickName&&this.hasLogin){var r={};r.user_name=t,r.password=n,r.userInfo=JSON.stringify(a),r.access_token=a.access_token,this.$api.bind_account(r).then(function(t){console.log("绑定成功 bind_account",t),a.user_info=t.data.rsm.user_info,a.uid=t.data.rsm.user_info.uid,a.access_token=t.data.rsm.access_token;var n=t.data.rsm.signature_token;n&&o.default.put("signature_token",n),console.log("bind_account userInfo",a),s.login(a),setTimeout(function(){e.navigateBack({delta:1})},1e3)}).catch(function(e){s.isRotate=!1,console.log("请求失败，可以在这里写处理代码",e)})}else i.default.showToast("请重新登录"),this.wxLogin(),this.showBind=!1}else i.default.errorToast("账号和密码不能为空")},isLogin:function(){try{var t=e.getStorageSync("setUserData");t&&(console.log("已登录用户：",t),this.$store.dispatch("setUserData",t),e.reLaunch({url:"../../../pages/index"}))}catch(n){}},startLogin:function(){if(this.isRotate)return!1;console.log("email",this.email),console.log("icode",this.icode),""!=this.phoneData.length?this.passData.length<5?i.default.errorToast("密码不正确"):(e.showLoading({title:"登录中"}),this.isRotate=!0,this.is_register?this.reg_account(this.phoneData,this.passData,this.email,this.icode):this.bind_account(this.phoneData,this.passData),setTimeout(function(){e.hideLoading(),this.isRotate=!1},1200)):i.default.errorToast("用户名不能为空")}})};t.default=u}).call(this,n("543d")["default"])},aa1f:function(e,t,n){"use strict";var i=n("59ca"),o=n.n(i);o.a},c40c:function(e,t,n){"use strict";n.r(t);var i=n("3cf8"),o=n("d1ce");for(var s in o)"default"!==s&&function(e){n.d(t,e,function(){return o[e]})}(s);n("aa1f");var a=n("2877"),r=Object(a["a"])(o["default"],i["a"],i["b"],!1,null,null,null);t["default"]=r.exports},d1ce:function(e,t,n){"use strict";n.r(t);var i=n("8cd7"),o=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,function(){return i[e]})}(s);t["default"]=o.a}},[["0945","common/runtime","common/vendor"]]]);