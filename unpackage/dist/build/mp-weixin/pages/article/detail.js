(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/article/detail"],{"0097":function(t,e,o){"use strict";(function(t){o("ee7b"),o("921b");i(o("66fd"));var e=i(o("3e4b"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"0226":function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return n})},"38a2":function(t,e,o){},"3e4b":function(t,e,o){"use strict";o.r(e);var i=o("0226"),n=o("a060");for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);o("d472");var r=o("2877"),s=Object(r["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=s.exports},"9e3c":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("2f62"),n=a(o("2e85"));function a(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},i=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),i.forEach(function(e){s(t,e,o[e])})}return t}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c={computed:r({},(0,i.mapState)(["userInfo","hasLogin","system_config"])),data:function(){return{InputBottom:0,isCard:!0,article_info:[],comments:[],article_topics:[],footerTips:"",last_id:"",isLoad:!1,reload:!1,isLastPage:!1,commentDisabled:!1,article_id:0,post_hash:"",CommentInput:!1}},onLoad:function(t){this.userInfo,this.hasLogin;var e=t.id;this.article_id=e,this.getArticleDetail()},onPullDownRefresh:function(){this.reload=!0,this.last_id=0,this.isLastPage=!1},onReachBottom:function(){},onShareAppMessage:function(t){"button"===t.from&&console.log(t.target)},methods:{preview:function(t,e){},navigate:function(t,e){},showCommentInput:function(e){var o=this.system_config;if(!o||"Y"==o.system_verify)return n.default.errorToast("小程序端暂不支持评论功能"),!1;var i=this.userInfo;i.uid>0&&this.hasLogin?(this.CommentInput=!0,t.setNavigationBarTitle({title:"评论文章"})):t.navigateTo({url:"../account/login"})},hideCommentInput:function(e){t.setNavigationBarTitle({title:this.article_info.title}),this.CommentInput=!1},formSubmit:function(e){var o=this,i=this.system_config;if(!i||"Y"==i.system_verify)return n.default.errorToast("小程序端暂不支持评论功能"),!1;var a=this.userInfo;if(!this.hasLogin||a.uid<1)return n.default.errorToast("请先登录"),t.navigateTo({url:"../account/login"}),!1;console.log("formSubmit",e);var r=e.detail.value.comment;if(!r||""==r)return n.default.errorToast("内容不能为空"),!1;if(n.default.strlen(r)<10)return n.default.errorToast("内容不能少于10个字"),!1;var s={};s.article_id=this.article_id,s.message=r,s.access_token=a.access_token,this.$api.post_article_comment(s).then(function(e){var i=e.data.rsm.comment_info.id;i>0?t.reLaunch({url:"/pages/article/detail?id="+o.article_id}):n.default.errorToast("系统异常，请返回")}).catch(function(t){console.log("提交评论失败",t)})},toPeople:function(e){console.log("toPeople",e);var o=e.currentTarget.dataset.uid;if(o>0)t.navigateTo({url:"../people/people?uid="+o});else{var i=e.currentTarget.dataset.anonymous;1!=i&&n.default.showToast("会员ID有误")}},article_vote:function(t){var e=this,o=t.currentTarget.dataset.id,i=t.currentTarget.dataset.type,a=t.currentTarget.dataset.rating,r=t.currentTarget.dataset.comment_idx;console.log("rating",t),i||(i="article"),o<1&&n.default.errorToast("ID有误");var s=this.userInfo;if(!s.uid||s.uid<1||!this.hasLogin)return this.toLogin(),!1;if(this.article_info.vote_info&&"article"==i&&a==this.article_info.vote_info.rating)return n.default.errorToast("你已经投票过了"),!1;var c={};c.access_token=s.access_token?s.access_token:"",c.item_id=o,c.rating=a,c.type=i,console.log("article_vote",c),this.$api.article_vote(c).then(function(t){"article"==i?(e.article_info.vote_info||(e.article_info.vote_info={}),e.article_info.vote_info.rating=a,console.warn("rating",a),e.article_info.votes=1==a?e.article_info.votes+1:e.article_info.votes-1):r&&(e.comments[r].vote_info||(e.comments[r].vote_info={}),e.comments[r].vote_info.rating=a,1==a?e.comments[r].votes=e.comments[r].votes+1:e.comments[r].votes>0&&(e.comments[r].votes=e.comments[r].votes-1))}).catch(function(t){console.log("文章投票失败",t)})},toTopicDetail:function(e){console.log("toTopicDetail",e);var o=e.currentTarget.dataset.topic_id;o>0?t.navigateTo({url:"../topic/detail?topic_id="+o}):n.default.showToast("话题ID有误")},toLogin:function(){t.navigateTo({url:"/pages/account/login",success:function(t){},fail:function(){},complete:function(){}})},toHome:function(){t.switchTab({url:"/pages/index/index"})},toBack:function(){var e=getCurrentPages();e.length>1?t.navigateBack({delta:1}):this.toHome()},InputBlur:function(t){this.InputBottom=0},getArticleDetail:function(){var e=this,o=this.article_id;if(o>0){this.article_id=o;var i=this.userInfo,a=[];a.id=o,a.access_token=i.access_token?i.access_token:"",this.$api.getArticleDetail(a).then(function(o){console.log("getArticleDetail",o);var i=o.data.rsm.article_info,a=o.data.rsm.article_topics;i?1==i.is_del?(n.default.errorToast("文章已被删除"),setTimeout(function(){t.navigateBack({delta:1})},1200)):(e.article_info=i,e.article_topics=a,o.data.rsm.totals>0?e.getArticleComments():e.isLastPage=!0,""!=i.title&&t.setNavigationBarTitle({title:i.title})):n.default.errorToast("内容不存在")}).catch(function(t){console.log("请求失败，可以在这里写处理代码",t)})}else n.default.errorToast("ID有误")},intGetList:function(){this.reload=!0,this.last_id=0,this.page=0,this.isLastPage=!1,this.getArticleComments()},getArticleComments:function(){var e=this,o=this.article_id;if(o>0){var i={},a=this.userInfo;if(i.access_token=a.access_token?a.access_token:"",i.article_id=o,i.minId=this.last_id?this.last_id:0,this.isLastPage)return t.stopPullDownRefresh(),this.isLoad=!0,n.default.showToast("没有更多评论了...."),!1;this.$api.getArticleComments(i).then(function(t){console.log("getArticleComments",t),e.isLoad=!1;var o=t.data.rsm.list;o.length>0?(e.comments=e.reload?o:e.comments.concat(o),e.last_id=o[o.length-1].id,e.reload=!1,o.length<20&&(e.isLoad=!0,e.isLastPage=!0)):(e.isLoad=!0,e.isLastPage=!0),o.length<1&&(e.footerTips="暂无评论")}).catch(function(t){console.log("请求失败，可以在这里写处理代码",t)})}else n.default.errorToast("动态ID错误")}}};e.default=c}).call(this,o("543d")["default"])},a060:function(t,e,o){"use strict";o.r(e);var i=o("9e3c"),n=o.n(i);for(var a in i)"default"!==a&&function(t){o.d(e,t,function(){return i[t]})}(a);e["default"]=n.a},d472:function(t,e,o){"use strict";var i=o("38a2"),n=o.n(i);n.a}},[["0097","common/runtime","common/vendor"]]]);