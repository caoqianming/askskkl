(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/publish"],{1645:function(t,e,o){"use strict";(function(t){o("ee7b"),o("921b");i(o("66fd"));var e=i(o("b896"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},2668:function(t,e,o){"use strict";o.r(e);var i=o("e646"),a=o.n(i);for(var n in i)"default"!==n&&function(t){o.d(e,t,function(){return i[t]})}(n);e["default"]=a.a},"55b7":function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.recent_topics,function(e,o){var i=t.SelectTopic.indexOf(e);return{$orig:t.__get_orig(e),g0:i}}));t.$mp.data=Object.assign({},{$root:{l0:o}})},a=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return a})},b896:function(t,e,o){"use strict";o.r(e);var i=o("55b7"),a=o("2668");for(var n in a)"default"!==n&&function(t){o.d(e,t,function(){return a[t]})}(n);var c=o("2877"),s=Object(c["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=s.exports},e646:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("2f62"),a=n(o("2e85"));function n(t){return t&&t.__esModule?t:{default:t}}function c(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},i=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),i.forEach(function(e){s(t,e,o[e])})}return t}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var r={computed:c({},(0,i.mapState)(["userInfo","hasLogin","system_config"])),data:function(){return{textareaHeight:100,NavigationBarTitle:"",post_anonymous:!1,type:"question",category_list:[],category:[],category_idx:-1,multiIndex:0,attach_access_key:"",isRotate:!1,AddTopicModal:!1,SelectTopic:[],topic_name:"",column_list:[],columns:[],column_idx:-1,showTopicList:!1,create_topic:null,recent_topics:[],search_topic:[],searchTopicName:""}},onLoad:function(e){var o=this.userInfo,i=this.hasLogin;if(!o.uid||o.uid<1&&!i)return t.navigateTo({url:"/pages/account/login"}),!1;var a=e.type,n="发起提问";"question"==a?(n="发起问题",this.type=a):"article"==a&&(n="发表文章",this.type=a),t.setNavigationBarTitle({title:n})},onShow:function(){this.intPublish()},onNavigationBarButtonTap:function(t){var e=this.$refs.edit.submit();console.log("内容为"+JSON.stringify(e.editItems))},methods:{searchTopic:function(t){var e=this;console.log("searchTopicName",t);var o=t.detail.value.searchTopicName;if(console.log("searchTopicName",o),!o)return a.default.errorToast("搜索内容不能为空"),!1;this.searchTopicName=o;var i=[];i.type="topics",i.q=o,i.limit=10,this.$api.search_topic(i).then(function(t){console.log("search_topic",t);var o=t.data.rsm.topic_data;if(o.length>0){for(var i=[],n=0;n<o.length;n++)i.push(o[n].name);e.search_topic=i}else a.default.errorToast("未找到相关话题")}).catch(function(t){console.log("搜索话题失败",t)})},MultiChange:function(t){this.multiIndex=t.detail.value,console.log("multiArray",this.multiArray)},delTopics:function(t){if(t>-1){console.log("删除话题"+t,this.SelectTopic[t]);var e=this.SelectTopic;e.splice(t,1),this.SelectTopic=e}},showTopicLists:function(){this.showTopicList=!this.showTopicList},showAddTopic:function(){console.log("showAddTopic"),this.AddTopicModal=!this.AddTopicModal},selectTopic:function(t){console.log("selectTopic",t);var e=t.currentTarget.dataset.topic_name;return e&&""!=e?-1!=this.SelectTopic.indexOf(e)?(a.default.errorToast("该话题已经添加过了"),!1):void(this.SelectTopic=this.SelectTopic.concat(e)):(a.default.errorToast("话题有误，请重新选择"),!1)},addTopic:function(t){var e=this;console.log("addTopic",t.detail.value);var o=t.detail.value.topic_name;return o&&""!=o?create_topic?-1!=this.SelectTopic.indexOf(o)?(a.default.errorToast("该话题已经添加过了"),!1):(this.SelectTopic=this.SelectTopic.concat(o),setTimeout(function(){e.topic_name=""},10),this.topic_name=" ",void this.showAddTopic()):(a.default.errorToast("你所在用户组无权新增话题"),!1):(a.default.errorToast("话题名称不能为空"),!1)},toBack:function(e){t.navigateBack({delta:1})},toHome:function(){t.reLaunch({url:"/pages/index/index"})},AnonymousChange:function(t){this.post_anonymous=t.detail.value},linechange:function(t){var e=t.detail.lineCount;this.textareaHeight=e>4?20*e:100},textareaAInput:function(t){console.log("已输入字数：",t.detail.cursor)},CategoryChange:function(t){console.log("已选择分类：",t.detail.value),t.detail.value>-1&&(this.category_idx=t.detail.value,console.log("已选择分类标题：",this.category_list[t.detail.value].title))},ColumnChange:function(t){console.log("已选择专栏：",t.detail.value),t.detail.value>-1&&(this.column_idx=t.detail.value,console.log("已选择专栏标题：",this.column_list[t.detail.value].column_name))},intCategory:function(t){var e=[];for(var o in t)e[o]=t[o].title;return e},intColumn:function(t){var e=[];for(var o in t)e[o]=t[o].column_name;return e},intPublish:function(){var e=this,o=this.type,i=this.userInfo;(!i.uid||i.uid<1)&&t.navigateTo({url:"/pages/account/login"});var a={};a.access_token=i.access_token,"question"==o?this.$api.intPublishQuestion(a).then(function(t){console.log("初始化发布 intPublishQuestion",t);var o=t.data.rsm.question_category_list;console.log("question_category_list",o),o&&(e.category_list=o,e.category=e.intCategory(o),e.attach_access_key=t.data.rsm.attach_access_key),e.create_topic=t.data.rsm.create_topic,e.recent_topics=t.data.rsm.recent_topics}).catch(function(t){console.log("初始化发布失败",t)}):"article"==o?this.$api.intPublishArticle(a).then(function(t){console.log("初始化发布 intPublishArticle",t);var o=t.data.rsm.article_category_list;console.log("article_category_list",o),o&&(e.category_list=o,e.category=e.intCategory(o)),e.create_topic=t.data.rsm.create_topic,e.recent_topics=t.data.rsm.recent_topics;var i=t.data.rsm.column_list;i&&(e.column_list=i,e.columns=e.intColumn(i),e.attach_access_key=t.data.rsm.attach_access_key)}).catch(function(t){console.log("初始化发布失败",t)}):this.toBack()},toLogin:function(){a.default.errorToast("请先登录"),setTimeout(function(){t.navigateTo({url:"/pages/account/login",success:function(t){},fail:function(){},complete:function(){}})},1200)},formSubmit:function(e){var o=this;this.isRotate=!0,console.log("formSubmit",e);var i=this.userInfo;(!i.uid||i.uid<1)&&(this.isRotate=!1,this.toLogin());var n=this.type,c=e.detail.value;if(!c.title)return a.default.errorToast("标题不能为空"),this.isRotate=!1,!1;if(!c.content&&"article"==n)return a.default.errorToast("文章内容不能为空"),this.isRotate=!1,!1;var s={};if(this.category_list.length>0){if(this.category_idx<0)return a.default.errorToast("请选择分类"),this.isRotate=!1,!1;var r=this.category_list[this.category_idx].id;console.log("分类 category_id",r),s.category_id=r}if(s.access_token=i.access_token,this.SelectTopic.length>0&&(s.topics=JSON.stringify(this.SelectTopic)),"question"==n)s.question_content=c.title,s.question_detail=c.content,s.anonymous=this.post_anonymous?1:0,s.attach_access_key=this.attach_access_key,this.$api.publish_question(s).then(function(e){if(!e.data.rsm)return setTimeout(function(){o.toHome()},1200),!1;var i=e.data.rsm.question_id;i&&i>0?t.reLaunch({url:"/pages/question/detail?id="+i}):setTimeout(function(){o.toHome()},1300)}).catch(function(t){o.isRotate=!1,console.log("发布问题失败",t)});else{if("article"!=n)return a.default.errorToast("系统出错"),!1;if(s.title=c.title,s.message=c.content,this.column_list.length>0)if(this.column_idx<0);else{var l=this.column_list[this.column_idx].column_id;console.log("专栏 column_id",l),s.column_id=l}s.attach_access_key=this.attach_access_key,this.$api.publish_article(s).then(function(e){if(!e.data.rsm)return setTimeout(function(){o.toHome()},1200),!1;var i=e.data.rsm.article_id;i&&i>0?t.reLaunch({url:"/pages/article/detail?id="+i}):setTimeout(function(){o.toHome()},1300)}).catch(function(t){console.log("发布文章失败",t)})}}}};e.default=r}).call(this,o("543d")["default"])}},[["1645","common/runtime","common/vendor"]]]);