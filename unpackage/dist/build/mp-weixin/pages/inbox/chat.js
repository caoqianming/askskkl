(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/inbox/chat"],{"036c":function(t,e,a){"use strict";var n=a("31b3"),i=a.n(n);i.a},"31b3":function(t,e,a){},4573:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a("2f62"),i=s(a("2e85"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),n.forEach(function(e){r(t,e,a[e])})}return t}function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u={computed:o({},(0,n.mapState)(["hasLogin","userInfo","system_config"])),data:function(){return{InputBottom:0,isBack:!1,reload:!1,isLoad:!0,isLastPage:!1,listData:[],page:0,dialog_id:0,recipient_user:[],chat_username:"",last_message:"",chat_message_value:""}},onLoad:function(t){var e=t.dialog_id,a=t.username;a&&(this.chat_username=a),e&&(this.dialog_id=e),e>0?this.getList():a&&this.showChat()},methods:o({},(0,n.mapMutations)(["login"]),{formSubmit:function(t){var e=t.detail.value,a=e.message;a&&this.inbox_send(a)},InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0},submitChat:function(t){var e=this.chat_message_value;this.inbox_send(e)},inbox_send:function(t){var e=this,a=this.userInfo;if(!a.uid||a.uid<1)return this.toLogin(),!1;if(t||(t=this.chat_message_value),!t||""==t||"undefined"==t)return i.default.errorToast("内容不能为空"),!1;if(this.last_message==t)return i.default.errorToast("请勿重复发送"),!1;var n={};n.recipient=this.chat_username,n.message=t,n.access_token=a.access_token?a.access_token:"",this.$api.inbox_send(n).then(function(n){console.log("inbox_send",n);var i={};i.message=t,i.add_time="刚刚",i.uid=a.uid;var s=e.listData.concat(i);e.listData=s,console.log(e.listData),e.last_message=t,setTimeout(function(){e.chat_message_value=""},10),e.chat_message_value=" "}).catch(function(t){console.log("请求出错了，可以在这里做失败处理",t)})},showChat:function(e){if(e||(e=this.chat_username),""==e||!e)return this.toBack(),!1;t.setNavigationBarTitle({title:"给 "+e+" 发私信"})},intGetList:function(){this.reload=!0,this.page=0,this.isLastPage=!1,this.getList()},getList:function(e){var a=this;if(e||(e=this.dialog_id),e<1)return this.toBack(),!1;var n={};if(this.isLastPage)return t.stopPullDownRefresh(),this.isLoad=!0,i.default.showToast("没有更多内容了...."),!1;var s=this.page+1;n.page=s,n.dialog_id=e;var o=this.userInfo;n.access_token=o.access_token?o.access_token:"",this.$api.chat_inbox(n).then(function(e){console.log("chat_inbox",e);var n=e.data.rsm.recipient_user;n&&(t.setNavigationBarTitle({title:"来自 "+n.user_name+" 的私信"}),a.recipient_user=n,a.chat_username=n.user_name),1==s&&(o.user_info.inbox_unread=0,a.login(o)),a.page=s,a.isLoad=!1;var r=e.data.rsm.list;console.log("list",r),r.length>0?(a.listData=a.reload?r:a.listData.concat(r),a.reload=!1,r.length<10&&(a.isLoad=!0,a.isLastPage=!0)):(a.isLoad=!0,a.isLastPage=!0,1==s&&(a.listData=[],i.default.errorToast("暂无私信内容"))),r.length<1&&(a.footerTips="暂无数据")}).catch(function(t){console.log("请求出错了，可以在这里做失败处理",t)})},toBack:function(){t.navigateBack({delta:1})},toLogin:function(){t.navigateTo({url:"/pages/account/login"})},topeople:function(e){if(!e)return!1;t.navigateTo({url:"/pages/people/people?uid="+e})}})};e.default=u}).call(this,a("543d")["default"])},"975d":function(t,e,a){"use strict";(function(t){a("ee7b"),a("921b");n(a("66fd"));var e=n(a("a2af"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},a2af:function(t,e,a){"use strict";a.r(e);var n=a("d83e"),i=a("edd6");for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);a("036c");var o=a("2877"),r=Object(o["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports},d83e:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},i=[];a.d(e,"a",function(){return n}),a.d(e,"b",function(){return i})},edd6:function(t,e,a){"use strict";a.r(e);var n=a("4573"),i=a.n(n);for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);e["default"]=i.a}},[["975d","common/runtime","common/vendor"]]]);